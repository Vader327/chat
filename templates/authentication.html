<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Sign Up</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
      crossorigin="anonymous"
    ></script>
  </head>

  <style>
    body {
      background-color: #eee;
    }
    .main {
      position: fixed;
      top: 35%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 30%;
    }
    .card {
      padding: 16px;
    }
    .card-title {
      margin-bottom: 32px !important;
    }

    #error_box{
      position: absolute;
      width: 100%;
      margin-top: 16px;
    }
  </style>

  <body>
    <div class="main">
      <div class="card text-center">
        <div class="card-body">
          <h2 class="card-title mb-3">Sign Up</h2>
          <form
            action="/api/signup"
            method="post"
            id="signupForm"
            class="d-grid gap-2"
          >
            <div class="form-floating mb-3">
              <input
                name="username"
                type="text"
                placeholder="Username"
                class="form-control"
                id="username-input"
              />
              <label for="username-input">Username</label>
            </div>

            <div class="form-floating mb-3">
              <input
                name="password"
                type="password"
                placeholder="Password"
                class="form-control"
                id="password-input"
              />
              <label for="password-input">Password</label>
            </div>
            <input
              type="submit"
              class="btn btn-primary btn-lg"
              value="Sign Up"
            />
          </form>
        </div>
      </div>

      <!--    
    <h2>Or</h2>

    <h2>Login</h2>

    <form action="/api/login" method="post" id="loginForm">
      <input name="username" type="text" placeholder="Username" />
      <input name="password" type="password" placeholder="Password" />
      <input type="submit" />
    </form>
    -->
      <div class="alert alert-danger" style="display: none;" role="alert" id="error_box">
      </div>
    </div>
  </body>

  <script>
    function validateForm(data) {
      if (data[0]["value"].trim() == "") {
        showError("Username cannot be empty!");
        return false;
      } else if (data[1]["value"].trim() == "") {
        showError("Password cannot be empty!");
        return false;
      } else {
        return true;
      }
    }

    function showError(value) {
      $("#error_box").text(value);
      $("#error_box").show();
    }

    $("#signupForm").on("submit", (e) => {
      e.preventDefault();
      if (validateForm($("#signupForm").serializeArray())) {
        $.ajax({
          url: "/api/signup",
          type: "post",
          data: $("#signupForm").serialize(),
          success: function (data) {
            console.log(data.status);
            if (data.status == "account_already_exists") {
              showError("Account already exists!");
            } else if (data.status == "success") {
              if ("{{ from_invite }}" == "True") {
                window.location.href = "/invite?code={{ invite_code }}";
              } else {
                window.location.href = "/";
              }
            }
          },
        });
      }
    });

    $("#loginForm").on("submit", (e) => {
      e.preventDefault();
      if (validateForm($("#loginForm").serializeArray())) {
        $.ajax({
          url: "/api/login",
          type: "post",
          data: $("#loginForm").serialize(),
          success: function (data) {
            if (data.status == "account_doesnt_exists") {
              showError("Account does not exist!");
            } else if (data.status == "incorrect_password") {
              showError("Incorrect Password!");
            } else if (data.status == "success") {
              if ("{{ from_invite }}" == "True") {
                window.location.href = "/invite?code={{ invite_code }}";
              } else {
                window.location.href = "/";
              }
            }
          },
        });
      }
    });
  </script>
</html>
